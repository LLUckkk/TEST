{
  "input_header": "def _pyproject_toml_to_requirements_txt( pyproject: Dict[str, Any], ) -> List[str]:",
  "input_docstring": "Convert a pyproject.toml file to a requirements.txt file.\n\nIf there is a `[tool.uv.sources]` section, we resolve the dependencies\nto their corresponding source.\n\n# dependencies = [\n#     \"python-gcode\",\n# ]\n#\n# [tool.uv.sources]\n# python-gcode = { git = \"https://github.com/fetlab/python_gcode\", rev = \"new\" }",
  "output_code": "def _pyproject_toml_to_requirements_txt(\n    pyproject: Dict[str, Any],\n) -> List[str]:\n    \n    dependencies = cast(List[str], pyproject.get(\"dependencies\", []))\n    if not dependencies:\n        return []\n\n    uv_sources = pyproject.get(\"tool\", {}).get(\"uv\", {}).get(\"sources\", {})\n\n    for dependency, source in uv_sources.items():\n        dep_index: int | None = None\n        for i, dep in enumerate(dependencies):\n            if (\n                dep == dependency\n                or dep.startswith(f\"{dependency}==\")\n                or dep.startswith(f\"{dependency}<\")\n                or dep.startswith(f\"{dependency}>\")\n                or dep.startswith(f\"{dependency}~\")\n            ):\n                dep_index = i\n                break\n\n        if dep_index is None:\n            continue\n\n        new_dependency = None\n\n        if \"git\" in source:\n            git_url = f\"git+{source['git']}\"\n            ref = (\n                source.get(\"rev\") or source.get(\"branch\") or source.get(\"tag\")\n            )\n            new_dependency = (\n                f\"{dependency} @ {git_url}@{ref}\"\n                if ref\n                else f\"{dependency} @ {git_url}\"\n            )\n        elif \"path\" in source:\n            new_dependency = f\"{dependency} @ {source['path']}\"\n\n        elif \"url\" in source:\n            new_dependency = f\"{dependency} @ {source['url']}\"\n\n        if new_dependency:\n            if source.get(\"marker\"):\n                new_dependency += f\"; {source['marker']}\"\n\n            dependencies[dep_index] = new_dependency\n\n    return dependencies",
  "input_contexts": [
    {
      "id": "marimo-team_marimo_547_3",
      "input_code": "def test_pyproject_toml_to_requirements_txt_with_marker():\n    pyproject = {\n        \"dependencies\": [\n            \"marimo\",\n            \"polars\",\n        ],\n        \"tool\": {\n            \"uv\": {\n                \"sources\": {\n                    \"marimo\": {\n                        \"git\": \"https://github.com/marimo-team/marimo.git\",\n                        \"tag\": \"0.1.0\",\n                        \"marker\": \"python_version >= '3.12'\",\n                    }\n                }\n            }\n        },\n    }\n    assert _pyproject_toml_to_requirements_txt(pyproject) == [\n        \"marimo @ git+https://github.com/marimo-team/marimo.git@0.1.0; python_version >= '3.12'\",        \"polars\",\n    ]\n"
    },
    {
      "id": "marimo-team_marimo_547_4",
      "input_code": "def test_pyproject_toml_to_requirements_txt_with_url_sources():\n    pyproject = {\n        \"dependencies\": [\n            \"marimo\",\n            \"polars\",\n        ],\n        \"tool\": {\n            \"uv\": {\n                \"sources\": {\n                    \"marimo\": {\n                        \"url\": \"https://github.com/marimo-team/marimo/archive/refs/heads/main.zip\",\n                    }\n                }\n            }\n        },\n    }\n    assert _pyproject_toml_to_requirements_txt(pyproject) == [\n        \"marimo @ https://github.com/marimo-team/marimo/archive/refs/heads/main.zip\",        \"polars\",\n    ]\n"
    },
    {
      "id": "marimo-team_marimo_547_1",
      "input_code": "def _get_dependencies(script: str) -> List[str] | None:\n    \n    try:\n        pyproject = _read_pyproject(script) or {}\n        return _pyproject_toml_to_requirements_txt(pyproject)\n    except Exception as e:\n        LOGGER.warning(f\"Failed to parse dependencies: {e}\")\n        return None\n"
    },
    {
      "id": "marimo-team_marimo_547_5",
      "input_code": "def test_pyproject_toml_to_requirements_txt_with_local_path():\n    pyproject = {\n        \"dependencies\": [\n            \"marimo\",\n            \"polars\",\n        ],\n        \"tool\": {\n            \"uv\": {\n                \"sources\": {\n                    \"marimo\": {\n                        \"path\": \"/Users/me/work/marimo\",\n                    }\n                }\n            }\n        },\n    }\n    assert _pyproject_toml_to_requirements_txt(pyproject) == [\n        \"marimo @ /Users/me/work/marimo\",\n        \"polars\",\n    ]\n"
    },
    {
      "id": "marimo-team_marimo_547_6",
      "input_code": "def test_pyproject_toml_to_requirements_txt_with_versioned_dependencies(\n    version_spec: str,\n):\n    pyproject = {\n        \"dependencies\": [\n            version_spec,\n        ],\n        \"tool\": {\n            \"uv\": {\n                \"sources\": {\n                    \"marimo\": {\n                        \"git\": \"https://github.com/marimo-team/marimo.git\",\n                        \"rev\": \"main\",\n                    },\n                }\n            }\n        },\n    }\n    assert _pyproject_toml_to_requirements_txt(pyproject) == [\n        \"marimo @ git+https://github.com/marimo-team/marimo.git@main\",\n    ]\n"
    },
    {
      "id": "marimo-team_marimo_547_2",
      "input_code": "def test_pyproject_toml_to_requirements_txt_git_sources():\n    pyproject = {\n        \"dependencies\": [\n            \"marimo\",\n            \"numpy\",\n            \"polars\",\n            \"altair\",\n        ],\n        \"tool\": {\n            \"uv\": {\n                \"sources\": {\n                    \"marimo\": {\n                        \"git\": \"https://github.com/marimo-team/marimo.git\",\n                        \"rev\": \"main\",\n                    },\n                    \"numpy\": {\n                        \"git\": \"https://github.com/numpy/numpy.git\",\n                        \"branch\": \"main\",\n                    },\n                    \"polars\": {\n                        \"git\": \"https://github.com/pola/polars.git\",\n                        \"branch\": \"dev\",\n                    },\n                }\n            }\n        },\n    }\n    assert _pyproject_toml_to_requirements_txt(pyproject) == [\n        \"marimo @ git+https://github.com/marimo-team/marimo.git@main\",\n        \"numpy @ git+https://github.com/numpy/numpy.git@main\",\n        \"polars @ git+https://github.com/pola/polars.git@dev\",\n        \"altair\",\n    ]\n"
    }
  ],
  "generated_inputs": [
    "<needimport>\nimport typing\nfrom typing import Dict, Any, List\n\n<testcase_1>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"requests\",\n        \"flask\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"requests\": {\n                    \"git\": \"https://github.com/psf/requests.git\",\n                    \"rev\": \"v2.25.1\",\n                },\n                \"flask\": {\n                    \"url\": \"https://github.com/pallets/flask/archive/refs/tags/2.0.1.zip\",\n                },\n            }\n        }\n    },\n}\n\n<testcase_2>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"django\",\n        \"numpy\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"django\": {\n                    \"git\": \"https://github.com/django/django.git\",\n                    \"branch\": \"stable/3.2.x\",\n                },\n                \"numpy\": {\n                    \"path\": \"/local/path/to/numpy\",\n                },\n            }\n        }\n    },\n}\n\n<testcase_3>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"pandas\",\n        \"scipy\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"pandas\": {\n                    \"git\": \"https://github.com/pandas-dev/pandas.git\",\n                    \"tag\": \"v1.3.3\",\n                },\n                \"scipy\": {\n                    \"url\": \"https://github.com/scipy/scipy/archive/refs/tags/v1.7.1.zip\",\n                },\n            }\n        }\n    },\n}\n\n<testcase_4>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"matplotlib\",\n        \"seaborn\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"matplotlib\": {\n                    \"git\": \"https://github.com/matplotlib/matplotlib.git\",\n                    \"rev\": \"v3.4.3\",\n                },\n                \"seaborn\": {\n                    \"path\": \"/local/path/to/seaborn\",\n                },\n            }\n        }\n    },\n}\n\n<testcase_5>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"pytest\",\n        \"hypothesis\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"pytest\": {\n                    \"git\": \"https://github.com/pytest-dev/pytest.git\",\n                    \"branch\": \"main\",\n                },\n                \"hypothesis\": {\n                    \"url\": \"https://github.com/HypothesisWorks/hypothesis/archive/refs/tags/v6.14.0.zip\",\n                },\n            }\n        }\n    },\n}"
  ],
  "gpt_output": "<needimport>\nimport typing\nfrom typing import Dict, Any, List\n\n<testcase_1>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"requests\",\n        \"flask\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"requests\": {\n                    \"git\": \"https://github.com/psf/requests.git\",\n                    \"rev\": \"v2.25.1\",\n                },\n                \"flask\": {\n                    \"url\": \"https://github.com/pallets/flask/archive/refs/tags/2.0.1.zip\",\n                },\n            }\n        }\n    },\n}\n\n<testcase_2>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"django\",\n        \"numpy\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"django\": {\n                    \"git\": \"https://github.com/django/django.git\",\n                    \"branch\": \"stable/3.2.x\",\n                },\n                \"numpy\": {\n                    \"path\": \"/local/path/to/numpy\",\n                },\n            }\n        }\n    },\n}\n\n<testcase_3>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"pandas\",\n        \"scipy\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"pandas\": {\n                    \"git\": \"https://github.com/pandas-dev/pandas.git\",\n                    \"tag\": \"v1.3.3\",\n                },\n                \"scipy\": {\n                    \"url\": \"https://github.com/scipy/scipy/archive/refs/tags/v1.7.1.zip\",\n                },\n            }\n        }\n    },\n}\n\n<testcase_4>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"matplotlib\",\n        \"seaborn\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"matplotlib\": {\n                    \"git\": \"https://github.com/matplotlib/matplotlib.git\",\n                    \"rev\": \"v3.4.3\",\n                },\n                \"seaborn\": {\n                    \"path\": \"/local/path/to/seaborn\",\n                },\n            }\n        }\n    },\n}\n\n<testcase_5>\npyproject: Dict[str, Any] = {\n    \"dependencies\": [\n        \"pytest\",\n        \"hypothesis\",\n    ],\n    \"tool\": {\n        \"uv\": {\n            \"sources\": {\n                \"pytest\": {\n                    \"git\": \"https://github.com/pytest-dev/pytest.git\",\n                    \"branch\": \"main\",\n                },\n                \"hypothesis\": {\n                    \"url\": \"https://github.com/HypothesisWorks/hypothesis/archive/refs/tags/v6.14.0.zip\",\n                },\n            }\n        }\n    },\n}",
  "needimport": "import typing\nfrom typing import Dict, Any, List\n\n",
  "test_results": {
    "ans1": [
      "requests @ git+https://github.com/psf/requests.git@v2.25.1",
      "flask @ https://github.com/pallets/flask/archive/refs/tags/2.0.1.zip"
    ],
    "ans2": [
      "django @ git+https://github.com/django/django.git@stable/3.2.x",
      "numpy @ /local/path/to/numpy"
    ],
    "ans3": [
      "pandas @ git+https://github.com/pandas-dev/pandas.git@v1.3.3",
      "scipy @ https://github.com/scipy/scipy/archive/refs/tags/v1.7.1.zip"
    ],
    "ans4": [
      "matplotlib @ git+https://github.com/matplotlib/matplotlib.git@v3.4.3",
      "seaborn @ /local/path/to/seaborn"
    ],
    "ans5": [
      "pytest @ git+https://github.com/pytest-dev/pytest.git@main",
      "hypothesis @ https://github.com/HypothesisWorks/hypothesis/archive/refs/tags/v6.14.0.zip"
    ]
  }
}